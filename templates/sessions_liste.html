{% extends "base.html" %}

{% block title %}Liste des membres{% endblock %}

{% block content %}
  <h1 class="mb-3">Sessions</h1>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mt-2">
        {% for category, message in messages %}
          <div class="alert alert-{{ 'warning' if category == 'error' else category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="mb-3">
    <a href="{{ url_for('session_nouvelle') }}" class="btn btn-primary">➕ Nouvelle session</a>
  </div>

  <div class="card">
    <div class="card-header">
      Liste des sessions
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Date début</th>
            <th>Date fin</th>
            <th>Active</th>
            <th>Clôturée</th>
            <th>Liens</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for s in sessions %}
          <tr>
            <td>{{ s.id }}</td>
            <td>{{ s.date_debut }}</td>
            <td>{{ s.date_fin }}</td>
            <td>
              {% if s.active %}
                <span class="badge bg-success">Oui</span>
              {% else %}
                <span class="badge bg-secondary">Non</span>
              {% endif %}
            </td>
            <td>
              {% if s.est_cloture %}
                <span class="badge bg-danger">Oui</span>
              {% else %}
                <span class="badge bg-secondary">Non</span>
              {% endif %}
            </td>
            <td>
              <a class="btn btn-sm btn-outline-primary"
                 href="{{ url_for('session_ministeres', session_id=s.id) }}">
                Ministères & rôles
              </a>
              <a class="btn btn-sm btn-outline-secondary mt-1"
                 href="{{ url_for('inscriptions_liste', session_id=s.id) }}">
                Inscriptions membres
              </a>
            </td>
            <td>
              <a href="{{ url_for('session_modifier', session_id=s.id) }}"
                 class="btn btn-sm btn-warning">Modifier</a>
              
              {# bouton supprimer #}
		  <form method="post"
			action="{{ url_for('session_supprimer', session_id=s.id) }}"
			onsubmit="return confirm('Supprimer définitivement la session {{ s.id }} et toutes ses inscriptions / ministères / membres de ministères ?');">
		    <button type="submit"
			    class="btn btn-sm btn-outline-danger">
		      Supprimer
		    </button>
		  </form>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="7" class="text-center">Aucune session pour le moment.</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      
      {% if pagination and pagination.pages > 1 %}
	<nav aria-label="Pagination" class="mt-3">
	  <ul class="pagination">

	    {% if pagination.has_prev %}
	      <li class="page-item">
		<a class="page-link" href="{{ url_for_other_page(pagination.prev_num) }}">«</a>
	      </li>
	    {% else %}
	      <li class="page-item disabled"><span class="page-link">«</span></li>
	    {% endif %}

	    {% for p in range(1, pagination.pages + 1) %}
	      <li class="page-item {% if p == pagination.page %}active{% endif %}">
		<a class="page-link" href="{{ url_for_other_page(p) }}">{{ p }}</a>
	      </li>
	    {% endfor %}

	    {% if pagination.has_next %}
	      <li class="page-item">
		<a class="page-link" href="{{ url_for_other_page(pagination.next_num) }}">»</a>
	      </li>
	    {% else %}
	      <li class="page-item disabled"><span class="page-link">»</span></li>
	    {% endif %}

	  </ul>
	</nav>
	{% endif %}

    </div>
  </div>

  <a href="{{ url_for('index') }}" class="btn btn-link mt-3">Retour à l'accueil</a>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
